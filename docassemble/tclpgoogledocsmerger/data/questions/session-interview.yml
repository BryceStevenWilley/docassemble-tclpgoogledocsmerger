metadata:
  title: Past Clause Searches
---
metadata:
  temporary session: True
---
reconsider: True
code: |
  current_info = user_info()
  list_of_interviews = list()
  next_id = None
  while True:
    next_item = interview_list(next_id=next_id)
    if not next_item:
      break
    (items, next_id) = next_item
    for info in items:
      if not info['metadata'].get('hidden', False):
        list_of_interviews.append(info)
    if not next_id:
        break
  if len(list_of_interviews) > 0:
    list_of_interviews += [dict()]
---
table: session_table
rows: |
  list_of_interviews
columns:
  - Search Date: |
      '<a href="' + interview_url(i=row_item['filename'], session=row_item['session']) + '">' + row_item['modtime'] + '</a>' if 'modtime' in row_item else ''
  - Delete: |
      action_button_html(url_action('delete', filename=row_item['filename'], session=row_item['session']), color='warning', label='Delete') if 'title' in row_item else action_button_html(url_action('delete_all'), color='danger', label='Delete All')
---
table css class: table table-striped
prevent going back: True
mandatory: True
question: |
  Past Clause Searches
subquestion: |
  ${ action_button_html(interview_url(i=user_info().package + ":search_and_download.yml",reset=1), label="Start a new Clause Search") }
  
  % if len(list_of_interviews) > 0:
  Click the search date
  to revisit a search
  you already started.

  ${ session_table }
  % else:
  You do not have any seaches.
  % endif
---
event: delete
code: |
  if interview_list(
      action='delete',
      filename=action_argument('filename'),
      session=action_argument('session')):
    log("Deleted interview", "success")
---
event: delete_all
code: |
  interview_list(action='delete_all')
  log("Deleted interviews", "success")
